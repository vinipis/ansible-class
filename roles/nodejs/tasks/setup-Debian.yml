---
- name: Ensure apt-transport-https is installed.
  apt: 
    name: apt-transport-https
    state: present

- name: Adding NodeSource apt_key
  apt_key:
    url: "https://deb.nodesource.com/gpgkey/nodesource.gpg.key"
    state: present
    validate_certs: False

- name: Installing a NodeJS staging version
  shell: "curl -sL https://deb.nodesource.com/setup_{{nodejs_version}} | sudo -E bash -"
  when: nodejs_version not in nodejs_stable_versions

- name: Add NodeSource repositories for LTS NodeJS.
  apt_repository:
    repo: "deb https://deb.nodesource.com/node_{{nodejs_version}} {{ ansible_distribution_release|lower }} main"
    validate_certs: False
  register: node_repo
  when: nodejs_version in nodejs_stable_versions


- name: Ensure Node.js and npm are installed.
  apt: 
    name: nodejs
    state: latest
  when: nodejs_version is not defined or nodejs_version not in nodejs_stable_versions

- name: Ensure Node.js and npm are installed.
  apt: 
    name: nodejs={{ nodejs_version|regex_replace('x', '') }}* 
    state: present
  when: nodejs_version is defined and nodejs_version in nodejs_stable_versions
